@import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap');

:root {
  --vp-w: 480px;
  --vp-h: 360px;

  /* Castle stone palette */
  --bt3-bg: #141315;
  --bt3-bg-highlight: #1f1d20;
  --bt3-panel: rgba(28, 27, 31, 0.92);
  --bt3-panel-border: #5b4f43;
  --bt3-panel-shadow: rgba(0, 0, 0, 0.85);
  --bt3-accent: #e0c782;
  --bt3-text: #f1ecdd;
  --bt3-muted: rgba(225, 216, 190, 0.72);
  --bt3-outline: #9a7b53;
  --bt3-glass: rgba(36, 29, 22, 0.42);

  /* CRT flavour tuned for the new panel */
  --crt-scanline-color-rgb: 236, 226, 194;
  --crt-scanline-alpha: 0.16;
  --crt-scanline-spacing: 3px;
  --crt-scanline-thickness: 1px;
  --crt-scanline-opacity: 0.7;
  --crt-vignette-opacity: 0.9;
  --crt-noise-size: 160px;
  --crt-glow-shadow: inset 0 0 140px rgba(0, 0, 0, 0.9);
}

* {
  box-sizing: border-box;
}

html,
body {
  height: 100%;
  margin: 0;
  background-color: var(--bt3-bg);
  background-image:
    radial-gradient(circle at 10% 12%, rgba(112, 104, 92, 0.25) 0, transparent 55%),
    radial-gradient(circle at 85% 18%, rgba(73, 66, 56, 0.25) 0, transparent 52%),
    repeating-linear-gradient(135deg, rgba(44, 40, 36, 0.4) 0 32px, rgba(26, 23, 21, 0.35) 32px 64px),
    repeating-linear-gradient(90deg, rgba(37, 33, 30, 0.45) 0 36px, rgba(24, 22, 20, 0.35) 36px 72px);
  background-size: auto, auto, 280px 280px, 360px 360px;
  color: var(--bt3-text);
  font-family: 'Press Start 2P', 'VT323', monospace;
  letter-spacing: 0.06em;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    linear-gradient(180deg, rgba(255, 245, 221, 0.04), rgba(0, 0, 0, 0.55)),
    repeating-linear-gradient(0deg, rgba(0, 0, 0, 0.2) 0 1px, transparent 1px 4px),
    radial-gradient(ellipse at center, transparent 35%, rgba(0, 0, 0, 0.85) 100%);
  mix-blend-mode: soft-light;
  pointer-events: none;
}

.bt3-ui {
  position: relative;
  z-index: 1;
  max-width: 1100px;
  margin: 24px auto 48px;
  padding: 24px 26px 150px;
  background: rgba(12, 11, 13, 0.82);
  border: 2px solid rgba(0, 0, 0, 0.8);
  box-shadow: 0 30px 60px rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(3px);
}

.bt3-ui::before {
  content: '';
  position: absolute;
  inset: -26px;
  background:
    repeating-linear-gradient(135deg, rgba(84, 76, 66, 0.7) 0 32px, rgba(58, 52, 45, 0.75) 32px 64px),
    linear-gradient(120deg, rgba(116, 100, 80, 0.4), rgba(46, 40, 32, 0.6));
  border: 6px solid rgba(20, 16, 12, 0.85);
  border-radius: 22px;
  box-shadow:
    inset 0 4px 30px rgba(0, 0, 0, 0.5),
    inset 0 -8px 24px rgba(0, 0, 0, 0.45),
    0 30px 50px rgba(0, 0, 0, 0.75);
  filter: drop-shadow(0 0 12px rgba(14, 11, 9, 0.75));
  z-index: -1;
}

.ui-header {
  text-align: center;
  text-transform: uppercase;
  margin-bottom: 24px;
}

.ui-header h1 {
  margin: 0;
  font-size: clamp(1.5rem, 5vw, 2.35rem);
  color: var(--bt3-accent);
  text-shadow: 0 0 10px rgba(223, 201, 150, 0.55);
}

.ui-header p {
  margin: 16px auto 0;
  max-width: 48ch;
  line-height: 1.65;
  font-size: 0.95rem;
  color: var(--bt3-muted);
}

.bt3-panels {
  display: grid;
  grid-template-columns: minmax(340px, var(--vp-w)) minmax(220px, 1fr);
  gap: 28px;
  align-items: start;
}

.viewport-stack {
  position: relative;
  width: var(--vp-w);
  height: var(--vp-h);
  padding: 16px 18px 42px;
  background:
    linear-gradient(115deg, rgba(64, 56, 48, 0.8), rgba(26, 22, 18, 0.95)),
    radial-gradient(circle at 50% 15%, rgba(140, 120, 96, 0.22), transparent 65%);
  border: 4px solid rgba(28, 21, 14, 0.85);
  border-radius: 18px;
  box-shadow:
    inset 0 0 18px rgba(0, 0, 0, 0.9),
    0 24px 48px rgba(0, 0, 0, 0.65);
  --crt-curvature-transform: perspective(950px) scale(0.992);
  --crt-overlay-filter: saturate(0.75) contrast(1.18);
}

.viewport-stack::before {
  content: '';
  position: absolute;
  inset: 8px;
  border-radius: 12px;
  border: 2px solid rgba(211, 185, 138, 0.18);
  box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.65);
  pointer-events: none;
}

.viewport3d {
  position: relative;
  width: 100%;
  height: 100%;
  background: radial-gradient(120% 120% at 50% 0%, rgba(24, 28, 35, 0.9) 0%, rgba(6, 7, 10, 0.96) 58%, rgba(0, 0, 0, 0.98) 100%);
  overflow: hidden;
  border: 1px solid rgba(255, 224, 158, 0.12);
}

.viewport3d canvas {
  display: block;
  width: 100%;
  height: 100%;
  image-rendering: pixelated;
  filter: saturate(0.68) contrast(1.22);
}

.viewport3d canvas.pixel-canvas {
  image-rendering: pixelated;
  filter: saturate(0.62) contrast(1.28);
}

.bezel-label {
  position: absolute;
  left: 50%;
  bottom: 10px;
  transform: translateX(-50%);
  padding: 5px 18px 6px;
  background: rgba(18, 14, 10, 0.85);
  border: 1px solid rgba(229, 204, 162, 0.35);
  box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.65), 0 6px 16px rgba(0, 0, 0, 0.6);
  font-size: 0.62rem;
  letter-spacing: 0.32em;
  text-transform: uppercase;
}

.sidebar {
  position: relative;
  background: var(--bt3-panel);
  border: 3px solid var(--bt3-outline);
  border-radius: 18px;
  box-shadow: inset 0 0 24px rgba(0, 0, 0, 0.78), 0 18px 38px rgba(0, 0, 0, 0.6);
  padding: 16px 16px 22px;
  min-height: calc(var(--vp-h) - 16px);
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.sidebar::before {
  content: '';
  position: absolute;
  inset: 8px;
  border-radius: 12px;
  border: 1px solid rgba(229, 204, 162, 0.18);
  box-shadow: inset 0 0 14px rgba(0, 0, 0, 0.6);
  pointer-events: none;
}

.panel-title {
  font-size: 0.82rem;
  color: var(--bt3-accent);
  text-align: center;
  letter-spacing: 0.22em;
}

.minimap {
  flex: 1 1 auto;
  padding: 12px;
  border: 2px solid rgba(235, 206, 162, 0.15);
  background: radial-gradient(circle at 40% 20%, rgba(61, 52, 42, 0.55), rgba(12, 10, 8, 0.92));
  position: relative;
  overflow: hidden;
  border-radius: 12px;
}

.legend {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 8px;
  font-size: 0.65rem;
  text-transform: uppercase;
  color: var(--bt3-muted);
  text-align: center;
}

.legend-item {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
}

.legend-cell {
  display: inline-block;
  width: 12px;
  height: 12px;
  margin-right: 4px;
  border: 1px solid rgba(255, 255, 255, 0.28);
  box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.6);
  vertical-align: middle;
}

.legend-cell.wall { background: #5b4f43; }
.legend-cell.door { background: #a47a3c; }
.legend-cell.you { background: #18c3ae; }

.bottom {
  margin-top: 28px;
  font-size: 0.7rem;
  color: var(--bt3-muted);
  line-height: 1.7;
}

.controls {
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 0.18em;
}

.help summary {
  cursor: pointer;
}

.help ul {
  margin: 12px 0 0;
  padding-left: 18px;
  line-height: 1.6;
}

.help code {
  font-family: 'VT323', monospace;
  background: rgba(0, 0, 0, 0.4);
  padding: 2px 4px;
}

/* Minimap grid */
.minimap .grid {
  display: grid;
  gap: 2px;
  background: rgba(255, 255, 255, 0.04);
  padding: 6px;
  border: 2px solid rgba(0, 0, 0, 0.45);
  box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.65);
}

.minimap .cell {
  width: 12px;
  height: 12px;
  background: rgba(24, 16, 29, 0.9);
  position: relative;
  box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.6);
}

.minimap .cell.visited { background: rgba(49, 33, 60, 0.95); }
.minimap .cell.void { background: rgba(12, 8, 15, 0.65); opacity: 0.6; }
.minimap .cell.current { outline: 2px solid var(--bt3-accent); outline-offset: -2px; }
.minimap .cell .facing {
  position: absolute;
  inset: 2px;
  background: var(--bt3-accent);
  clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
  opacity: 0.9;
}
.minimap .cell.wall-n { border-top: 2px solid rgba(255, 255, 255, 0.15); }
.minimap .cell.wall-e { border-right: 2px solid rgba(255, 255, 255, 0.15); }
.minimap .cell.wall-s { border-bottom: 2px solid rgba(255, 255, 255, 0.15); }
.minimap .cell.wall-w { border-left: 2px solid rgba(255, 255, 255, 0.15); }
.minimap .cell.door-n { border-top: 2px dashed rgba(255, 204, 128, 0.8); }
.minimap .cell.door-e { border-right: 2px dashed rgba(255, 204, 128, 0.8); }
.minimap .cell.door-s { border-bottom: 2px dashed rgba(255, 204, 128, 0.8); }
.minimap .cell.door-w { border-left: 2px dashed rgba(255, 204, 128, 0.8); }

/* Hover coordinate tooltip */
.minimap .cell:hover::after {
  content: attr(data-pos);
  position: absolute;
  left: 14px;
  top: -2px;
  font-size: 0.55rem;
  color: var(--bt3-accent);
  background: rgba(0, 0, 0, 0.8);
  padding: 2px 4px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  white-space: nowrap;
  z-index: 2;
}

/* HUD overlay styling */
#bt3-overlay {
  position: fixed;
  left: 50%;
  bottom: 0;
  transform: translateX(-50%);
  width: min(960px, 92vw);
  padding: 14px 18px;
  border: 3px solid var(--bt3-outline);
  border-bottom-width: 0;
  background: linear-gradient(180deg, rgba(32, 26, 19, 0.94), rgba(10, 9, 8, 0.97));
  color: var(--bt3-text);
  font-size: 0.7rem;
  text-transform: uppercase;
  box-shadow: 0 -12px 30px rgba(0, 0, 0, 0.75);
  max-height: 40vh;
  overflow-y: auto;
  z-index: 50;
}

#bt3-overlay::-webkit-scrollbar {
  width: 8px;
}

#bt3-overlay::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.25);
}

#bt3-party {
  display: grid;
  gap: 6px;
  font-size: 0.68rem;
}

#bt3-log {
  margin-top: 12px;
  padding-top: 12px;
  border-top: 1px dashed rgba(255, 255, 255, 0.2);
  line-height: 1.6;
  font-size: 0.6rem;
  white-space: pre-wrap;
}

.hidden {
  display: none !important;
}

#bt3-actions {
  margin-top: 10px;
  padding: 10px 12px;
  background: rgba(18, 16, 14, 0.9);
  border: 2px solid rgba(154, 123, 83, 0.55);
  box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.65);
  display: grid;
  gap: 8px;
  font-size: 0.62rem;
}

.bt3-actions__prompt {
  color: var(--bt3-accent);
}

.bt3-actions__target {
  display: flex;
  gap: 8px;
  align-items: center;
}

#bt3-actions select {
  background: rgba(10, 9, 8, 0.95);
  color: var(--bt3-text);
  border: 1px solid rgba(255, 255, 255, 0.2);
  font-family: 'Press Start 2P', 'VT323', monospace;
  font-size: 0.58rem;
  padding: 4px 6px;
}

.bt3-actions__buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

#bt3-actions button {
  font-family: 'Press Start 2P', 'VT323', monospace;
  font-size: 0.6rem;
  letter-spacing: 0.05em;
  padding: 6px 12px;
  border: 2px solid rgba(224, 199, 130, 0.6);
  background: linear-gradient(180deg, rgba(64, 58, 52, 0.95), rgba(26, 22, 20, 0.95));
  color: var(--bt3-text);
  cursor: pointer;
  transition: transform 0.12s ease, box-shadow 0.12s ease;
}

#bt3-actions button:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.45);
}

#bt3-actions button:active {
  transform: translateY(0);
  box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.6);
}

@media (max-width: 960px) {
  .bt3-panels {
    grid-template-columns: 1fr;
    justify-items: center;
  }

  .sidebar {
    width: min(100%, 420px);
    min-height: auto;
  }

  .viewport-stack {
    margin: 0 auto;
  }
}
